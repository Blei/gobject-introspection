2005-05-17  Matthias Clasen  <mclasen@redhat.com>

	* TODO: Updates

	* metadata-format.txt: Cleanups by Maciej Katafiasz.

2005-05-15  Matthias Clasen  <mclasen@redhat.com>

	* src/*.c: Change the directory to be addressed by
	1-based indexes, and use an index of zero to mean
	'no object'.

2005-05-15  Matthias Clasen  <mclasen@redhat.com>

	* tests/roundtrips.sh (SIMPLE_TESTS): Add union.test.

	* tests/union.test: Add a union test.

	* src/generate.c: Handle unions.

	* src/girepository.h: 
	* src/ginfo.c: Add GIUnionInfo and functions to access it.

	* src/gidlnode.c: Handle GIdlNodeUnion nodes. 

	* src/gidlparser.c (start_union): Parse <union> elements.

	* src/gidlnode.h: Add a GIdlNodeUnion.

	* gidl.dtd: Add a <union> element.

	* src/gmetadata.c (g_metadata_check_sanity): Check
	union_blob_size.

	* src/gmetadata.h: Add union_blob_size to Header,
	add a UnionBlob.

	* metadata-format.txt: Add a UnionBlob.

2005-05-13  Matthias Clasen  <mclasen@redhat.com>

	* tests/*: Update testcases. 

	* src/generate.c (write_callable_info): Don't forget to
	write transfer and null-ok attributes for return types
	and parameters.

	* src/girepository.h: 
	* src/ginfo.c (g_callable_info_may_return_null): 
	New function to find out if a function may return NULL.

	* src/compiler.c (format_output): Make the generated
	C code compile.

	* README: Point to a recent libffi snapshot.

	* tests/invoke/*: Some invoke tests.

	* src/Makefile: Add ginvoke.c and the necessary
	libffi information.

	* src/girepository.h (g_function_info_invoke): Add 
	a GError argument.

	* src/ginvoke.c (g_function_info_invoke): Initial 
	implementation of invoke functionality based on libffi.

	* src/gidlnode.c (g_idl_node_build_metadata): Pass the
	strings and types hash tables in the right order when 
	recursing.
	(find_entry_node): Free the name parts.

2005-05-12  Johan Dahlin  <johan@gnome.org>

	* src/generate.c: Generate consistent end tags.
	
	* tests/*: Update

2005-05-12  Matthias Clasen  <mclasen@redhat.com>

	* TODO: Updates

	* src/gidlparser.c (start_function): Actually add
	methods to objects.  (Steven Walter)

	* src/girepository.h: 
	* src/ginfo.c: Rename Transfer and Direction to
	GITransfer and GIDirection. (Torsten Schoenfeld)

	* tests/*: Make tests work with the changes in name
	handling.
	
	* src/gidlnode.c (find_entry_node): Parse qualified
	names and generate xref nodes for them if needed. Don't
	require all modules to be loaded any more.

	* src/gidlmodule.c (g_idl_module_build_metadata): Choke
	on '.' in names.

	* src/ginfo.c (g_object_info_get_parent): Return NULL
	if blob->parent is 0. Still need to make sure index
	0 is not used.

	* src/generate.c: Generate qualified names when
	referring to non-local types. Emit transfer attribute
	for return types.

	* src/compiler.c (format_output): Put the function 
	attributes where gcc accepts them.

2005-05-11  Matthias Clasen  <mclasen@redhat.com>

	* src/compiler.c (main): Add a --verbose cmdline option
	and only log messages if it is specified.

	* src/gidlnode.h: 
	* src/gidlnode.c (init_stats, dump_stats): Collect some 
	statistics on string and type sharing.

	* src/gidlmodule.c (g_idl_module_build_metadata): Use
	g_message() instead of fprintf().

	* src/gidlnode.c (g_idl_node_free): Make this more robust.
	(g_idl_node_get_size): Implement for structs.
	(g_idl_node_get_full_size): Handle parent being NULL.
	(serialize_type): Handle lookup failures more gracefully.

2005-05-10  Matthias Clasen  <mclasen@redhat.com>

	* src/gidlnode.c (g_idl_node_get_full_size): Correct the 
	size calculation for 2-parameter types and for objects.

	* src/compiler.c: Add a cmdline option for debug output
	and install a log handler to implement it.
	* src/gidlnode.c: Add some debug spew.
	
	* TODO: Updates

	* src/gidlmodule.c (g_idl_module_build_metadata): Don't
	forget to count the module name when calculating the
	required size for the metadata.

	* src/gidlnode.c: 
	* src/gidlparser.c: Fix compiler warnings.

2005-05-09  Matthias Clasen  <mclasen@redhat.com>

	* src/compiler.c (main): Free the option context.

	* gidl.dtd: Clean up handling of names. All elements
	have a "name", only the elements corresponding to
	actual callable functions (function, method, constructor),
	have an additional "symbol" attribute holding the
	dlsym()-able function name.

	* src/generate.c: Adapt to generate xml matching the
	new dtd.

	* src/gidlparser.c:
	* src/gidlnode.c: Adapt to parse the new dtd.

	* tests/*.test: Adjust to the new dtd.
	
	* metadata-format.txt:
	* src/gmetadata.h: Remove the short_name field
	from the ValueBlob.
	* src/gmetadata.c: Shrink size of ValueBlob to 12.
	* src/girepository.h:
	* src/ginfo.c (g_value_info_get_short_name): Removed 
	
2005-05-09  Matthias Clasen  <mclasen@redhat.com>

	* gidl.dtd: Allow constructors for boxed types,
	patch by Jonathan Blandford.


2005-05-09  Matthias Clasen  <mclasen@redhat.com>

	* --- Initial import ---
